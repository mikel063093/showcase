<script>
var carrito = {{ app.session.get('carrito').id }};

$(document).ready(function() {
    setVerMas();
    setReservaArticulos();
	$("#menu-categoria a").click(function (e) {
        e.preventDefault();
        var elemento = $(this);
        var id = elemento.attr('value');
        $.ajax({
            type: "GET",
            url: "{{ path('establecimientosCategoria') }}/"+id,
            dataType: "html",
            success: function(data) {
                $("#carrusel").cycle('stop');
                $("#item-establecimientos").parent().children().removeClass('active');
                $("#item-establecimientos").addClass('active');
                elemento.parent().parent().children().children().removeClass('activo');
                elemento.addClass('activo');

                $('#home').html(data);
            },
        });
    });

    $("#item-establecimientos").click(function (e) {
        e.preventDefault();
        var id = 0;
        $.ajax({
            type: "GET",
            url: "{{ path('establecimientosCategoria') }}/"+id,
            dataType: "html",
            success: function(data) {
                removerClase('vistaEstable');
                $("#item-establecimientos").parent().children().removeClass('active');
                $("#item-establecimientos").addClass('active');
                $('#menu-categoria a').removeClass('activo');
                $('#menu-categoria a[value=0]').addClass('activo');
                $("#carrusel").cycle('stop');
                $('#home').html(data);
            },
        });
    });
    $("#item-nosotros").click(function (e) {
        e.preventDefault();

        $.ajax({
            type: "GET",
            url: "{{ path('nosotros') }}",
            dataType: "html",
            success: function(data) {
                $("#carrusel").cycle('stop');
                removerClase('vistaNosotros');

                $('#home').html(data);
            },
        });
    });

    $("#item-planes").click(function (e) {
        e.preventDefault();

            $.ajax({
            type: "GET",
            url: "{{ path('planes') }}",
            dataType: "html",
            success: function(data) {
                $("#carrusel").cycle('stop');
                removerClase('vistaPlanes');

                $('#home').html(data);
            },
        });
    });

    $("#item-contacto").click(function (e) {
        e.preventDefault();

        $.ajax({
            type: "GET",
            url: "{{ path('contacto') }}",
            dataType: "html",
            success: function(data) {
                $("#carrusel").cycle('stop');
                removerClase('vistaContacto');

                $('#home').html(data);
            },
        });
    });

    $("#masEstablecimientos").click(function (e) {
        e.preventDefault();

        $.ajax({
            type: "POST",
            url: "{{ path('masEstablecimientos') }}",
            dataType: "html",
            success: function(data) {
                $("#carrusel").cycle('stop');
                removerClase('vistaEstable');

                $('#home').html(data);
            },
        });
    });

    $("#masArticulos").click(function (e) {
        e.preventDefault();

        $.ajax({
            type: "POST",
            url: "{{ path('masArticulos') }}",
            dataType: "html",
            success: function(data) {
                $("#carrusel").cycle('stop');
                removerClase('vistaEstable');

                $('#home').html(data);
            },
        });
    });

    $('#buscar').autocomplete({
        source: "{{ path('autoCompletarBusquedaWeb') }}",
            minLength: 1,
            select: function(e, ui){

                $.ajax({
                    type: "POST",
                    url: "{{ path('realizarBusquedaWeb') }}",
                    dataType: "html",
                    data:{palabra:ui.item.value},
                    success: function(data) {
                        $("#carrusel").cycle('stop');
                        removerClase('vistaEstable');
                        $('#home').html(data);
                    },
                });
            }


    }).focusout(function() {
        $.ajax({
            type: "POST",
            url: "{{ path('realizarBusquedaWeb') }}",
            dataType: "html",
            data:{palabra:$(this).val()},
            success: function(data) {
                $("#carrusel").cycle('stop');
                removerClase('vistaEstable');
                $('#home').html(data);
            },
        });
    })

    $(".articulos img").click(function (e) {
        $string2="";
        var id = $(this).data('id');
        articuloModal = $(this).parent();
        $.ajax({
            type: "POST",
            url: "{{ path('articuloWeb') }}",
            dataType: "json",
            data:{
                idElemento: id
            },
            success: function (data) {
                $string2 = data.vista;
                modalArticulo($string2);
                return false;
            }
        });

    });


});

    function setVerMas(){
        $(".establecimientos a").click(function(e){
            e.preventDefault();
            var id = $(this).attr('value');
            $.ajax({
                type: "GET",
                url: "{{ path('establecimiento') }}/"+id,
                dataType: "html",
                success: function(data) {
                    removerClase('vistaEstable');
                    $("#carrusel").cycle('stop');
                    $('#home').html(data);
                },
            });
        })
    }

    function setReservaArticulos(){
        $('.menos').click(function (e) {
            e.preventDefault();
            let elemento = $(this);
            let contador = elemento.siblings('.cantidad');
            let cantidad = contador.text();

            if(cantidad > 0){

                let unidades = elemento.parent().siblings('.informacion').children('#unidades');

                $.ajax({
                    type: "POST",
                    url: "{{ path('eliminarProductoCarritoWeb') }}",
                    dataType: "json",
                    data: {
                        idArticulo: elemento.attr('value'),
                        idCarrito: carrito,
                        cantidad:1
                    },
                    success: function (data){
                        if(data.estado){
                            contador.text(parseInt(cantidad) - 1);
                            $('#carrito').html(data.carro);
                            mostrarMensaje(data.mensaje,'Exito');
                        }else{
                            mostrarMensaje(data.mensaje,'Fallo');
                        }
                        unidades.text(data.cantidadArticulo+' unidades');
                    }
                });
            }

        });

        $('.mas').click(function (e){
            e.preventDefault();
            let elemento = $(this);

            let contador = elemento.siblings('.cantidad');
            let cantidad = contador.text();


            let unidades = elemento.parent().siblings('.informacion').children('#unidades');

            $.ajax({
                type: "POST",
                url: "{{ path('agregarProductoCarritoWeb') }}",
                dataType: "json",
                data: {
                    idArticulo: elemento.attr('value'),
                    idCarrito: carrito,
                    cantidad:1
                },
                success: function (data){
                    if(data.estado){
                        contador.text( parseInt(cantidad) + 1);
                        $('#carrito').html(data.carro);
                        mostrarMensaje(data.mensaje,'Exito');
                    }else{
                        mostrarMensaje(data.mensaje,'Fallo');
                    }
                    unidades.text(data.cantidadArticulo+' unidades');
                }
            });


        });
    }


    function removerClase(clase){
        var categorias = $('.categorias');
        categorias.css('display','');
        if(clase == "vistaPlanes" || clase == "vistaContacto" || clase == "vistaPedido"){
            categorias.css('display','none');
        }
        var divContenedor = $("#home");
        divContenedor.removeAttr('class');
        divContenedor.addClass(clase);

    }
</script>