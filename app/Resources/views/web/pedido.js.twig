<script>
    var login = "";
    var cancelar = "";
    var recuperar = "";
    $(document).ready(function (){
        {% if not app.request.isXmlHttpRequest %}
            removerClase('vistaPedido');

        {% endif %}
        obtenerModales();
        // Selector con el cual se hace el llamado a la ventana de cancelar pedido
        var $enlaceCancelar = $("section.vistaPedido form.pedido div.contDer a.cancelar");
        //Llama a la ventana modal
        $enlaceCancelar.click(function() {
            modalCancelar(cancelar);
            return false;
        });
        // Selector con el cual se hace el llamado a la ventana de iniciar sesion
        var $enlaceSesion = $("section.vistaPedido form.pedido div.contDer a.ingShowcase");
        //Llama a la ventana modal
        $enlaceSesion.click(function(e) {
            modalLogin(login);
            return false;
        });

        $('.menos').click(function (e) {
            e.preventDefault();
            let elemento = $(this);
            let contador = elemento.siblings('.cantidad');
            let cantidad = contador.text();

            if(cantidad > 0){
                contador.text(parseInt(cantidad) - 1);
                let unidades = elemento.parent().siblings('.informacion').children('#unidades');

                $.ajax({
                    type: "POST",
                    url: "{{ path('eliminarProductoCarritoWeb') }}",
                    dataType: "json",
                    data: {
                        idArticulo: elemento.attr('value'),
                        idCarrito: carrito,
                        cantidad:1
                    },
                    success: function (data){
                        if(data.estado){
                            $('#carrito').html(data.carro);
                            $('#lista').html(data.pedido);
                            mostrarMensaje(data.mensaje,'Exito');
                        }else{
                            mostrarMensaje(data.mensaje,'Fallo');
                        }
                        unidades.text(parseInt(cantidad) - 1);
                    }
                });
            }

        });

        $('.mas').click(function (e){
            e.preventDefault();
            let elemento = $(this);

            let contador = elemento.siblings('.cantidad');
            let cantidad = contador.text();

            contador.text( parseInt(cantidad) + 1);
            let unidades = elemento.parent().siblings('.informacion').children('#unidades');

            $.ajax({
                type: "POST",
                url: "{{ path('agregarProductoCarritoWeb') }}",
                dataType: "json",
                data: {
                    idArticulo: elemento.attr('value'),
                    idCarrito: carrito,
                    cantidad:1
                },
                success: function (data){
                    if(data.estado){
                        $('#carrito').html(data.carro);
                        $('#lista').html(data.pedido);
                        mostrarMensaje(data.mensaje,'Exito');
                    }else{
                        mostrarMensaje(data.mensaje,'Fallo');
                    }
                    unidades.text(parseInt(cantidad) + 1);
                }
            });


        });
    });

    function obtenerModales(){
        $.ajax({
            type: "POST",
            url: "{{ path('obtenerLogin') }}",
            dataType: "json",

            success: function (data) {
                login = data.login;
            }
        });

        $.ajax({
            type: "POST",
            url: "{{ path('obtenerCancelar') }}",
            dataType: "json",

            success: function (data){
                cancelar = data.cancelar;
            }
        });

        $.ajax({
            type: "POST",
            url: "{{ path('obtenerRecuperar') }}",
            dataType: "json",

            success: function (data){
                recuperar = data.recuperar;

            }
        });
    };
</script>